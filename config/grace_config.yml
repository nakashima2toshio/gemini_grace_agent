# =============================================================================
# GRACE Agent 設定ファイル
# =============================================================================
# 環境変数での上書き: GRACE_<SECTION>_<KEY>
# 例: GRACE_LLM_MODEL=gemini-2.0-flash-lite

version: "1.0"

# -----------------------------------------------------------------------------
# LLM設定
# -----------------------------------------------------------------------------
llm:
  provider: "gemini"
  model: "gemini-2.0-flash"
  temperature: 0.7
  max_tokens: 4096
  timeout: 30

# -----------------------------------------------------------------------------
# Embedding設定
# -----------------------------------------------------------------------------
embedding:
  provider: "gemini"
  model: "gemini-embedding-001"
  dimensions: 3072

# -----------------------------------------------------------------------------
# Confidence計算設定
# -----------------------------------------------------------------------------
confidence:
  weights:
    search_quality: 0.25
    source_agreement: 0.20
    llm_self_eval: 0.25
    tool_success: 0.15
    query_coverage: 0.15
  thresholds:
    silent: 0.9      # > 0.9: 自動実行
    notify: 0.7      # 0.7-0.9: 通知のみ
    confirm: 0.4     # 0.4-0.7: 確認要求
    # escalate: < 0.4 人間介入必須

# -----------------------------------------------------------------------------
# 介入設定
# -----------------------------------------------------------------------------
intervention:
  default_timeout: 300  # 5分
  auto_proceed_on_timeout: false
  max_clarification_rounds: 3

# -----------------------------------------------------------------------------
# リプラン設定
# -----------------------------------------------------------------------------
replan:
  max_replans: 3
  confidence_threshold: 0.4
  partial_replan_threshold: 0.6
  cooldown_seconds: 5

# -----------------------------------------------------------------------------
# コスト管理設定
# -----------------------------------------------------------------------------
cost:
  daily_limit_usd: 10.0
  hourly_limit_usd: 2.0
  per_query_limit_usd: 0.50
  warning_threshold: 0.8  # 80%で警告

# -----------------------------------------------------------------------------
# エラーハンドリング設定
# -----------------------------------------------------------------------------
error:
  max_retries: 3
  retry_delay_base: 1.0  # 秒
  retry_delay_max: 30.0
  exponential_backoff: true

# -----------------------------------------------------------------------------
# ログ設定
# -----------------------------------------------------------------------------
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "logs/grace.log"
  max_size_mb: 100
  backup_count: 5

# -----------------------------------------------------------------------------
# Qdrant設定
# -----------------------------------------------------------------------------
qdrant:
  url: "http://localhost:6333"
  collection_name: "customer_support_faq"
  search_limit: 5
  score_threshold: 0.45

# -----------------------------------------------------------------------------
# ツール設定
# -----------------------------------------------------------------------------
tools:
  enabled:
    - rag_search
    - web_search
    - reasoning
    - ask_user